{"ast":null,"code":"import { __awaiter, __extends, __generator } from \"tslib\";\nimport { extendWithAge } from '../factories/WithAge';\nimport { extendWithGender } from '../factories/WithGender';\nimport { ComposableTask } from './ComposableTask';\nimport { ComputeAllFaceDescriptorsTask, ComputeSingleFaceDescriptorTask } from './ComputeFaceDescriptorsTasks';\nimport { extractAllFacesAndComputeResults, extractSingleFaceAndComputeResult } from './extractFacesAndComputeResults';\nimport { nets } from './nets';\nimport { PredictAllFaceExpressionsTask, PredictAllFaceExpressionsWithFaceAlignmentTask, PredictSingleFaceExpressionsTask, PredictSingleFaceExpressionsWithFaceAlignmentTask } from './PredictFaceExpressionsTask';\nvar PredictAgeAndGenderTaskBase = /** @class */function (_super) {\n  __extends(PredictAgeAndGenderTaskBase, _super);\n  function PredictAgeAndGenderTaskBase(parentTask, input, extractedFaces) {\n    var _this = _super.call(this) || this;\n    _this.parentTask = parentTask;\n    _this.input = input;\n    _this.extractedFaces = extractedFaces;\n    return _this;\n  }\n  return PredictAgeAndGenderTaskBase;\n}(ComposableTask);\nexport { PredictAgeAndGenderTaskBase };\nvar PredictAllAgeAndGenderTask = /** @class */function (_super) {\n  __extends(PredictAllAgeAndGenderTask, _super);\n  function PredictAllAgeAndGenderTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PredictAllAgeAndGenderTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResults, ageAndGenderByFace;\n      var _this = this;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResults = _a.sent();\n            return [4 /*yield*/, extractAllFacesAndComputeResults(parentResults, this.input, function (faces) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4 /*yield*/, Promise.all(faces.map(function (face) {\n                        return nets.ageGenderNet.predictAgeAndGender(face);\n                      }))];\n                    case 1:\n                      return [2 /*return*/, _a.sent()];\n                  }\n                });\n              });\n            }, this.extractedFaces)];\n          case 2:\n            ageAndGenderByFace = _a.sent();\n            return [2 /*return*/, parentResults.map(function (parentResult, i) {\n              var _a = ageAndGenderByFace[i],\n                age = _a.age,\n                gender = _a.gender,\n                genderProbability = _a.genderProbability;\n              return extendWithAge(extendWithGender(parentResult, gender, genderProbability), age);\n            })];\n        }\n      });\n    });\n  };\n  PredictAllAgeAndGenderTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsTask(this, this.input);\n  };\n  return PredictAllAgeAndGenderTask;\n}(PredictAgeAndGenderTaskBase);\nexport { PredictAllAgeAndGenderTask };\nvar PredictSingleAgeAndGenderTask = /** @class */function (_super) {\n  __extends(PredictSingleAgeAndGenderTask, _super);\n  function PredictSingleAgeAndGenderTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PredictSingleAgeAndGenderTask.prototype.run = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var parentResult, _a, age, gender, genderProbability;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, this.parentTask];\n          case 1:\n            parentResult = _b.sent();\n            if (!parentResult) {\n              return [2 /*return*/];\n            }\n\n            return [4 /*yield*/, extractSingleFaceAndComputeResult(parentResult, this.input, function (face) {\n              return nets.ageGenderNet.predictAgeAndGender(face);\n            }, this.extractedFaces)];\n          case 2:\n            _a = _b.sent(), age = _a.age, gender = _a.gender, genderProbability = _a.genderProbability;\n            return [2 /*return*/, extendWithAge(extendWithGender(parentResult, gender, genderProbability), age)];\n        }\n      });\n    });\n  };\n  PredictSingleAgeAndGenderTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsTask(this, this.input);\n  };\n  return PredictSingleAgeAndGenderTask;\n}(PredictAgeAndGenderTaskBase);\nexport { PredictSingleAgeAndGenderTask };\nvar PredictAllAgeAndGenderWithFaceAlignmentTask = /** @class */function (_super) {\n  __extends(PredictAllAgeAndGenderWithFaceAlignmentTask, _super);\n  function PredictAllAgeAndGenderWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\n    return new PredictAllFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  PredictAllAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptors = function () {\n    return new ComputeAllFaceDescriptorsTask(this, this.input);\n  };\n  return PredictAllAgeAndGenderWithFaceAlignmentTask;\n}(PredictAllAgeAndGenderTask);\nexport { PredictAllAgeAndGenderWithFaceAlignmentTask };\nvar PredictSingleAgeAndGenderWithFaceAlignmentTask = /** @class */function (_super) {\n  __extends(PredictSingleAgeAndGenderWithFaceAlignmentTask, _super);\n  function PredictSingleAgeAndGenderWithFaceAlignmentTask() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n  PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceExpressions = function () {\n    return new PredictSingleFaceExpressionsWithFaceAlignmentTask(this, this.input);\n  };\n  PredictSingleAgeAndGenderWithFaceAlignmentTask.prototype.withFaceDescriptor = function () {\n    return new ComputeSingleFaceDescriptorTask(this, this.input);\n  };\n  return PredictSingleAgeAndGenderWithFaceAlignmentTask;\n}(PredictSingleAgeAndGenderTask);\nexport { PredictSingleAgeAndGenderWithFaceAlignmentTask };","map":{"version":3,"mappings":"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","names":["extendWithAge","extendWithGender","ComposableTask","ComputeAllFaceDescriptorsTask","ComputeSingleFaceDescriptorTask","extractAllFacesAndComputeResults","extractSingleFaceAndComputeResult","nets","PredictAllFaceExpressionsTask","PredictAllFaceExpressionsWithFaceAlignmentTask","PredictSingleFaceExpressionsTask","PredictSingleFaceExpressionsWithFaceAlignmentTask","__extends","parentTask","input","extractedFaces","_super","_this","PredictAllAgeAndGenderTask","parentResults","_a","faces","Promise","all","map","ageGenderNet","predictAgeAndGender","face","ageAndGenderByFace","parentResult","i","age","gender","genderProbability","PredictAgeAndGenderTaskBase","PredictSingleAgeAndGenderTask","_b","PredictAllAgeAndGenderWithFaceAlignmentTask","PredictSingleAgeAndGenderWithFaceAlignmentTask"],"sources":["../../../src/globalApi/PredictAgeAndGenderTask.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}